version: '3.7'

x-env_file:
  &env_file
  - ./.env

services:
  postgres-db:
    image: postgres:13.0-alpine
    env_file:
      *env_file
    volumes:
      - postgres-db:/var/lib/postgresql/data

  backend:
    build:
      context: .
      dockerfile: ./conf/backend/Dockerfile
    depends_on:
      - postgres-db
    env_file:
      *env_file
    environment:
      - PYTHONDONTWRITEBYTECODE=1
    volumes:
      - ./code:/code
      - ./conf/backend/scripts:/scripts
      - backend-home:/home/user
    init: true
    command: ['/scripts/run.sh']

  frontend:
    image: node:14.15-alpine
    env_file:
      *env_file
    volumes:
      - frontend-home:/home/user
    init: true
    command: ['sleep', '365d']

volumes:
  postgres-db:
  backend-home:
  frontend-home: